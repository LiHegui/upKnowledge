## é«˜é˜¶ç»„ä»¶ï¼ˆå·²å‘-æå’Œè´µï¼‰

### é«˜é˜¶ç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ

::: tip
é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æ˜¯ React ä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§é«˜çº§æŠ€å·§ã€‚HOC è‡ªèº«ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼ã€‚

**é«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°**
:::

åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¯¥ç»„ä»¶è¿›è¡Œpropså¤„ç†ï¼Œäº‹ä»¶å¤„ç†ç­‰å·¥ä½œ

### è®¤è¯†é«˜é˜¶ç»„ä»¶

1. å¤ç”¨é€»è¾‘

    å¯¹ç»„ä»¶è¿›è¡ŒåŠ å·¥å¤„ç†ï¼Œæ ¹æ®éœ€æ±‚æ¥å®šåˆ¶ä¸“å±åŒ–çš„HOC

2. å¼ºåŒ–props
  
    åŠ«æŒä¸Šä¸€å±‚ä¼ è¿‡æ¥çš„props,æ··å…¥æ–°çš„props

3. èµ‹èƒ½ç»„ä»¶
  
    HOCæœ‰ä¸€é¡¹ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥ç»™è¢«HOCåŒ…è£¹çš„ä¸šåŠ¡ç»„ä»¶ï¼Œæä¾›ä¸€äº›æ‹“å±•åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¢å¤–çš„äº‹ä»¶ï¼Œä½†æ˜¯è¿™ç§HOCï¼Œå¯èƒ½éœ€è¦å’Œä¸šåŠ¡ç»„ä»¶ç´§å¯†ç»“åˆ

4. æ§åˆ¶æ¸²æŸ“
  
    åŠ«æŒæ¸²æŸ“æ˜¯hocä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨wrapComponentåŒ…è£…ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¯¹åŸæ¥çš„ç»„ä»¶ï¼Œè¿›è¡Œæ¡ä»¶æ¸²æŸ“ï¼ŒèŠ‚æµæ¸²æŸ“ï¼Œæ‡’åŠ è½½ç­‰åŠŸèƒ½

**ä½¿ç”¨æ–¹å¼**

- è£…é¥°å™¨æ¨¡å¼

- å‡½æ•°åŒ…è£¹

**ä¸¤ç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶**

- æ­£å‘çš„å±æ€§ä»£ç†
    ```javascript
      function HOC(WrapComponent){
        return class Advance extends React.Component{
          state={
              name:'loong'
          }
          render(){
              return <WrapComponent  { ...this.props } { ...this.state }  />
          }
        }
      }
    ```

    æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œreturn è¿”å›ç»“æœæ˜¯çˆ¶ç»„ä»¶ï¼ˆä»£ç†ç»„ä»¶ï¼‰å¯¹å­ç»„ä»¶ï¼ˆä¸šåŠ¡ç»„ä»¶ï¼‰çš„ä¸€ç³»åˆ—æ“ä½œ

    **åœ¨ fiber treeä¸Šï¼Œå…ˆmountedç»„ä»¶ï¼Œç„¶åæ‰æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶**

- åå‘çš„ç»„ä»¶ç»§æ‰¿
    ```javascript
        class Index extends React.Component{
            render(){
                return <div> hello,world  </div>
            }
        }
        function HOC(Component){
            return class wrapComponent extends Component{

            }
        }
        export default HOC(Index) 
    ```
    HOCé‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼, ä»£ç†ç»„ä»¶ç»§æ‰¿äº†ä¸šåŠ¡ç»„ä»¶çš„æœ¬èº«ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥å®ä¾‹åŒ–ä»£ç†ç»„ä»¶HOCå³å¯

### ç¼–å†™é«˜é˜¶ç»„ä»¶

å¾ˆå¤šæ–‡ç« å¯¹å…¶æœ‰å¾ˆå¤šåˆ†ç±»ï¼Œæˆ‘è¿™é‡Œå°±æŒ‰ç…§æˆ‘çš„ç†è§£å»åˆ†ç±»

1. å¢å¼ºprops
    æ··å…¥props ä»£ç†ç»„ä»¶stateçŠ¶æ€ä¼šæ··å…¥ï¼ˆä¸Šé¢æœ‰æ··å…¥çš„ä¾‹å­ï¼‰, åˆæ¬¡ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œæ§åˆ¶stateçš„æ›´æ–°
    ```javascript
    function classHOC(WrapComponent){
        return class  Idex extends React.Component{
            constructor(){
                super()
                this.state={
                    name:'alien'
                }
            }
            changeName(name){
                this.setState({ name })
            }
            render(){
                return <WrapComponent { ...this.props }  { ...this.state } changeName={this.changeName.bind(this)  }  />
            }
        }
    }
    function Index(props){
        const [ value ,setValue ] = useState(null)
        const { name ,changeName } = props
        return <div>
            <div>   hello,world , my name is { name }</div>
            æ”¹å˜name <input onChange={ (e)=> setValue(e.target.value)  }  />
            <button onClick={ ()=>  changeName(value) }  >ç¡®å®š</button>
        </div>
    }

    export default classHOC(Index)
    ```

    æˆ‘ä»¬çœ‹è¿™ä¸ªä¾‹å­ï¼Œä»£ç†ç»„ä»¶ä¸­`changeName={this.changeName.bind(this)} `ï¼Œç»‘å®šchangeNameæ–¹æ³•ã€‚ç”¨æ¥æ›´æ–°nameå±æ€§ï¼ˆä»£ç†ç»„ä»¶ä¸­ï¼Œè¯´å®è¯è®©æˆ‘æƒ³èµ·æ¥äº†é—­åŒ…ï¼‰ã€‚

    é¢˜å¤–è¯ï¼šä¸Šé¢çš„ä¾‹å­ä¸­changeNameç»‘å®šçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååˆ©ç”¨bindæ”¹å˜å…¶thisæŒ‡å‘ï¼ˆè¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œåœ¨Indexç»„ä»¶ä½¿ç”¨çš„æ—¶å€™`<button onClick={ ()=>  changeName(value) }  >ç¡®å®š</button>` , æ‰å¯ä»¥æ­£ç¡®æ›´æ–°åˆ°ä»£ç†ç»„å»ºçš„stateã€‚å¦‚æœä¸ç»‘å®šå°±ä¼šæ‰¾ä¸åˆ°è¯¥æ–¹æ³•ã€‚

2. æ§åˆ¶æ¸²æŸ“
    ä»£ç†ç»„ä»¶é€šè¿‡å¤„ç†å¯ä»¥æ§åˆ¶å­ç»„ä»¶æ˜¯å¦æ˜¾ç¤º

    å¯ä»¥é€šè¿‡å˜é‡æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶å®ƒæ–¹å¼ã€‚è¾¾åˆ°æ§åˆ¶æ¸²æŸ“çš„ç›®çš„å°±å¯ä»¥äº†

    æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¼˜åŒ–çš„ä¾‹å­ğŸ’¨

    ```javascript
        function HOC (Component){
            return function renderWrapComponent(props){
                const { num } = props
                const RenderElement = useMemo(() =>  <Component {...props}  /> ,[ num ])
                return RenderElement
            }
        }
        class Index extends React.Component{
        render(){
            console.log(`å½“å‰ç»„ä»¶æ˜¯å¦æ¸²æŸ“`,this.props)
            return <div>hello,world, my name is alien </div>
        }
        }
        const IndexHoc = HOC(Index)

        export default ()=> {
            const [ num ,setNumber ] = useState(0)
            const [ num1 ,setNumber1 ] = useState(0)
            const [ num2 ,setNumber2 ] = useState(0)
            return <div>
                <IndexHoc  num={ num } num1={num1} num2={ num2 }  />
                <button onClick={() => setNumber(num + 1) } >num++</button>
                <button onClick={() => setNumber1(num1 + 1) } >num1++</button>
                <button onClick={() => setNumber2(num2 + 1) } >num2++</button>
            </div>
        }
    ```
    ä¸Šé¢çš„ä¾‹å­åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œä»£ç†ç»„ä»¶é€šè¿‡useMemoé’©å­æ¥ä¾æ®propsä¼ å…¥çš„num,æ¥å†³å®šæ˜¯å¦æ›´æ–°å­ç»„ä»¶

3. åŠ«æŒç”Ÿå‘½å‘¨æœŸ

```javascript
function HOC (Component){
  const proDidMount = Component.prototype.componentDidMount 
  Component.prototype.componentDidMount = function(){
     console.log('åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼šcomponentDidMount')
     proDidMount.call(this)
  }
  return class wrapComponent extends React.Component{
      render(){
        return <Component {...this.props}  />
      }
  }
}
```

ä¹Ÿæ˜¯å¾ˆå¥½ç†è§£ï¼Œä»£ç†ç»„ä»¶ä¿å­˜å­ç»„å»ºçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œç„¶åé‡æ–°è®¾ç½®å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°

4. äº‹ä»¶å¤„ç†

æˆ‘ä»¬æ¥çœ‹åˆ†æä¸‹é¢è¿™ä¸ªä¾‹å­ğŸ’¨

```javascript
function ClickHoc (Component){
  return  function Wrap(props){
    const dom = useRef(null)
    useEffect(()=>{
     const handerClick = () => console.log('å‘ç”Ÿç‚¹å‡»äº‹ä»¶') 
     dom.current.addEventListener('click',handerClick)
     return () => dom.current.removeEventListener('click',handerClick)
    },[])
    return  <div ref={dom} ><Component  {...props} /></div>
  }
}
```
å…¶å®å°±æ˜¯ä»£ç†ç»„ä»¶ä¸Šé¢åŠ äº†ä¸€ä¸ªclickç›‘å¬äº‹ä»¶

5. è·å–è‡ªå®šä¹‰ç»„ä»¶ref
   
   æˆ‘ä»¬çŸ¥é“åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šé¢refæ˜¯æ— ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†ç»„ä»¶åŒ…è£¹ä¸šåŠ¡ç»„ä»¶å³å¯ï¼Œ`ref={dom}`åœ¨ä»£ç†ç»„ä»¶ä¸Šï¼Œå³å¯è·å–
   ```javascript
    return  <div ref={dom} ><Component  {...props} /></div>
   ```

### é«˜é˜¶ç»„ä»¶å®è·µ

å¯ä»¥å‚å¡`æ¨èæ–‡ç« `ä¸­çš„è¿™ä¸€ç« èŠ‚ï¼Œå†™çš„å¾ˆè¯¦ç»†



### æ¨èæ–‡ç« 

[ã€Œreactè¿›é˜¶ã€ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶(HOC)](https://juejin.cn/post/6940422320427106335?searchId=20240314203945EF18D3514FDD63A655E1#heading-44)
